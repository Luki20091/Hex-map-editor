<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hex Map Editor - BETA</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            overflow: hidden;
        }
        canvas {
            display: block;
            background-color: #000;
            cursor: pointer;
        }
        #controls {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(255, 255, 255, 0.9);
            padding: 10px;
            border-radius: 8px;
        }
        input[type="color"] {
            margin: 5px 0;
        }
        button {
            display: block;
            margin: 5px 0;
            padding: 5px 10px;
            border: none;
            background: #007BFF;
            color: #fff;
            cursor: pointer;
            border-radius: 4px;
        }
        button:hover {
            background: #0056b3;
        }
    </style>
</head>
<body>
    <canvas id="hexCanvas"></canvas>
    <div id="controls">
        <label for="colorPicker">Pick a Color:</label>
        <input type="color" id="colorPicker" value="#ff0000">
        <button id="exportButton">Export to JSON</button>
        <button id="importButton">Import from JSON</button>
        <input type="file" id="fileInput" style="display:none;">
    </div>
    <script>
        const canvas = document.getElementById("hexCanvas");
        const ctx = canvas.getContext("2d");
        const colorPicker = document.getElementById("colorPicker");
        const exportButton = document.getElementById("exportButton");
        const importButton = document.getElementById("importButton");
        const fileInput = document.getElementById("fileInput");

        // Hex map parameters
        const hexRadius = 30;
        const hexHeight = Math.sqrt(3) * hexRadius;
        const hexWidth = 2 * hexRadius;
        const hexVerticalSpacing = hexHeight;
        const cols = 20;
        const rows = 20;
        const hexMap = [];
        let isPainting = false;

        canvas.width = cols * hexWidth * 0.75 + hexRadius;
        canvas.height = rows * hexVerticalSpacing + hexHeight / 2;

        // Initialize hex map
        for (let r = 0; r < rows; r++) {
            for (let q = 0; q < cols; q++) {
                const xOffset = q * hexWidth * 0.75;
                const yOffset = r * hexVerticalSpacing + (q % 2 === 0 ? 0 : hexHeight / 2);
                hexMap.push({ q, r, s: -q - r, color: "#000000" });
            }
        }

        // Draw hexagon
        function drawHex(x, y, color = "#000000") {
            ctx.beginPath();
            for (let i = 0; i < 6; i++) {
                const angle = Math.PI / 3 * i;
                const xOffset = x + Math.cos(angle) * hexRadius;
                const yOffset = y + Math.sin(angle) * hexRadius;
                ctx.lineTo(xOffset, yOffset);
            }
            ctx.closePath();
            ctx.fillStyle = color;
            ctx.fill();
            ctx.strokeStyle = "#000";
            ctx.stroke();
        }

        // Draw the map
        function drawMap() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            hexMap.forEach((hex) => {
                const x = hex.q * hexWidth * 0.75 + hexRadius;
                const y = hex.r * hexVerticalSpacing + (hex.q % 2 === 0 ? hexHeight / 2 : 0) + hexHeight / 2;
                drawHex(x, y, hex.color);
            });
        }

        // Get hex under mouse
        function getHexAt(x, y) {
            for (const hex of hexMap) {
                const hexX = hex.q * hexWidth * 0.75 + hexRadius;
                const hexY = hex.r * hexVerticalSpacing + (hex.q % 2 === 0 ? hexHeight / 2 : 0) + hexHeight / 2;
                const dx = x - hexX;
                const dy = y - hexY;
                if (Math.sqrt(dx * dx + dy * dy) < hexRadius) {
                    return hex;
                }
            }
            return null;
        }

        // Paint a hex
        function paintHex(event) {
            const rect = canvas.getBoundingClientRect();
            const mouseX = event.clientX - rect.left;
            const mouseY = event.clientY - rect.top;
            const hex = getHexAt(mouseX, mouseY);
            if (hex) {
                hex.color = colorPicker.value;
                drawMap();
            }
        }

        // Mouse events for painting
        canvas.addEventListener("mousedown", (event) => {
            isPainting = true;
            paintHex(event);
        });

        canvas.addEventListener("mousemove", (event) => {
            if (isPainting) {
                paintHex(event);
            }
        });

        canvas.addEventListener("mouseup", () => {
            isPainting = false;
        });

        canvas.addEventListener("mouseleave", () => {
            isPainting = false;
        });

        // Export map to JSON
        exportButton.addEventListener("click", () => {
            const dataStr = JSON.stringify(hexMap, null, 2);
            const blob = new Blob([dataStr], { type: "application/json" });
            const url = URL.createObjectURL(blob);
            const a = document.createElement("a");
            a.href = url;
            a.download = "hexmap.json";
            a.click();
        });

        // Import map from JSON
        importButton.addEventListener("click", () => {
            fileInput.click();
        });

        fileInput.addEventListener("change", (event) => {
            const file = event.target.files[0];
            const reader = new FileReader();
            reader.onload = (e) => {
                const data = JSON.parse(e.target.result);
                data.forEach((importedHex, index) => {
                    hexMap[index].color = importedHex.color;
                });
                drawMap();
            };
            reader.readAsText(file);
        });

        drawMap();
    </script>
</body>
</html>
